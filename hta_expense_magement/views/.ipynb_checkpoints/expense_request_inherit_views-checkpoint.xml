<odoo>
  <data>
    <!-- explicit list view definition -->
     <record model="ir.ui.view" id="expense_request_form_inherits">
      <field name="model">expense.request</field>
      <field name="inherit_id" ref="expense_management.expense_request_view"/>
      <field name="arch" type="xml">
          
          <xpath expr="//header/button[@name='button_approve']" position='after'>
              <button name="button_authorize"
                    string="Autoriser"
                    type="object"
                    class="oe_highlight"
                    states="authorize"
                    groups="account.group_account_user"
            />
              <button name="button_to_cancel"
                    string="Annuler"
                    type="object"
                    class="oe_highlight"
                    states="authorize"
                    groups="account.group_account_user"
            />
          </xpath>
          <xpath expr="//header/field[@name='state']" position='replace'>
              <field name="state"
                 widget="statusbar"
                 statusbar_visible="draft,submit,validate,to_approve,approved,authorize,post,cancel"
                 statusbar_colors='{"approved":"blue"}'
             />
          </xpath>
          
          <xpath expr="//sheet/group/group[2]/field[@name='balance_amount']" position='replace'>
              <field name="balance_amount" readonly='True' attrs="{'invisible': [('state','!=', 'to_approve'),('requested_by','!=', 'expense_approver')]}"/>
          </xpath>
          <xpath expr="//sheet/group/group[1]" position='replace'>
              <group>
                      <field name="expense_approver" options="{'no_create': True}" required='True' 
                             attrs="{'readonly': [('state', 'in', ['post', 'approve','to_cancel'])]}"
                      />
                      <field name='journal' options="{'no_create': True}" attrs="{'readonly': [('state', 'in', ['post','to_cancel'])],'invisible': [('state', 'in', ['draft','submit','validate','to_approve'])],'required': [('state', 'in', ['approve'])]}"/>
                      <field name="statement_id" string="Journal Caisse" options="{'no_create': True}"
                             attrs="{'readonly': [('state', 'in', ['post','to_cancel'])],'invisible': [('state', 'in', ['draft','submit','validate','to_approve'])],'required': [('state', 'in', ['approve'])]}"
                      />
             </group>
          </xpath>
          <xpath expr="//sheet/notebook/page/field[@name='line_ids']" position='replace'>
              <field name="line_ids"  attrs="{'readonly': [('state', 'in', ['approve', 'post','to_cancel',])]}">
                          <tree>
                              <field name='name'/>
                              <field name='date'/>
                              <field name='employee_id'/>
                              <field name="expense_product" options="{'no_create_edit': True}"/>
                              <field name='amount'/>
                              <!--<field name='payment_mode'/>-->
                              <field name='analytic_account'/>
                              <field name='request_state'/>
                          </tree>
                      </field>
          </xpath>
      </field>
    </record>
    <record id="view_expense_request_filter_hta" model="ir.ui.view">
            <field name="name">expense.requestlist.select</field>
            <field name="model">expense.request</field>
            <field name="priority" eval="15"/>
            <field name="arch" type="xml">
                <search string="Search Expense Request">
                    <field name="name" string="Expense" filter_domain="['|', '|', ('name', 'ilike', self)]"/>
                    <field name="expense_approver" />
                    <field name="requested_by"/>
                    
                    
                    <!-- We only allow to search on the following sale order line fields (product, name) because the other fields, such as price, quantity, ...
                        will not be searched as often, and if they need to be searched it's usually in the context of products
                        and then they can be searched from the page listing the sale order lines related to a product (from the product itself).
                    -->
                    <field name="company_id"/>
                    <separator/>
                    <filter string="Mes Demandes" name="my_expense" domain="[('requested_by', '=', uid)]"/>
                    <separator/>
                    <filter string="Demandes" name="draft" domain="[('state','in',('draft', 'submit'))]"/>
                    <filter string="Demande Valider" name="expense" domain="[('state','in',('post','approve'))]"/>
                    <separator/>
                    <filter string="Date" name="filter_create_date" date="create_date"/>
                    <group expand="0" string="Group By">
                    
                        <filter string="Utilisateur" name="requested_by" domain="[]" context="{'group_by': 'requested_by'}"/>
                        <filter name="expense_approver" string="Valideur" domain="[]" context="{'group_by': 'expense_approver'}"/>
                        
                    </group>
               </search>
            </field>
        </record>  
  </data>
</odoo>