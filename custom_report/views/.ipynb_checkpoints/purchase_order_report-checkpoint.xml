<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="inherit_report_purchasequotation_document" inherit_id="purchase.report_purchasequotation_document">
        
        <!-- Add custom sequence in purchase-->
        <xpath expr="//div[hasclass('page')]/h2" position="replace">
            <h4 class="text-center">DEMANDE DE COTATION/RFQ N°: <span t-field="o.name"/></h4>
            <!-- Adding date and project in purchase request-->
            <div id="informations" class="row mt32 mb32">
                <div class="col-6 bm-2">
                    <strong>DATE:</strong>
                    <span t-field="o.date_order" class="m-0"/>
                </div>
                <div class="col-6 bm-2">
                    <strong>PROJET:</strong>
                    <span t-field="o.project_id" class="m-0"/>
                </div>
            </div>
        </xpath>
        <!-- Delete company header-->
        <xpath expr="//t[@t-set='address']" position="replace"></xpath>
        <!-- Adding shipping address at bottom-->
        <xpath expr="//div[hasclass('page')]/p[@t-field='o.notes']" position="before">
            <strong>Adresse de livraison:</strong>
            <span t-field="o.dest_address_id" t-options='{"widget": "contact", "fields": ["address", "phone"], "no_marker": True,}'/>
        </xpath>
        <!-- Deleting shipping address on top-->
        <xpath expr="//t[@t-call='web.external_layout']/t[3]" position="replace"></xpath>
        <!-- Overriding purchase request table -->
        <xpath expr="//table[hasclass('table', 'table-sm')]//thead/tr" position="replace">
            <tr>
                <th class="text-left"><strong>Description</strong></th>
                <th class="text-center"><strong>Unit</strong></th>
                <th class="text-center"><strong>Qty</strong></th>
            </tr>
        </xpath>
        
        <xpath expr="//table[hasclass('table', 'table-sm')]//tbody/t[1]" position="replace">
            <t t-foreach="o.order_line" t-as="order_line">
                <tr t-att-class="'bg-200 font-weight-bold o_line_section' if order_line.display_type == 'line_section' else 'font-italic o_line_note' if order_line.display_type == 'line_note' else ''">
                    <td class="text-left">
                        <span t-field="order_line.name"/>
                    </td>
                    <td class="text-center">
                        <span t-field="order_line.product_uom"/>
                    </td>
                    <td class="text-center">
                        <span t-field="order_line.product_qty"/>
                    </td>
                </tr>
            </t>
        </xpath>
    </template>
    
    <template id="inherit_report_purchaseorder_document" inherit_id="purchase.report_purchaseorder_document">
        
        <xpath expr="//t[@t-set='address']" position="replace"></xpath>
        <!-- Add custom sequence in purchase-->
        <xpath expr="//div[hasclass('page')]/h2[1]" position="replace"></xpath>
        <xpath expr="//div[hasclass('page')]/h2[1]" position="replace">
            <h4 class="text-center" t-if="o.state in ['sent', 'to approve']" style="color: #cb2020;">BON DE COMMANDE N°BC: <span t-field="o.name"/></h4>
        </xpath>
        <xpath expr="//div[hasclass('page')]/h2[1]" position="replace">
            <h4 class="text-center" t-if="o.state in ['purchase', 'done']" style="color: #cb2020;">BON DE COMMANDE N°BC: <span t-field="o.name"/></h4>
        </xpath>
        <xpath expr="//div[hasclass('page')]/h2[1]" position="replace" style="color: #cb2020;">
            <h4 class="text-center" t-if="o.state == 'cancel'">(ANNULE) BON DE COMMANDE N°BC: <span t-field="o.name"/></h4>
        </xpath>
        <!-- Adding shipping address at bottom-->
        
        <!-- Adding custom company header-->
        <xpath expr="//div[hasclass('page')]/div[@id='informations']" position="replace">
            <div id="informations" class="d-flex">
                <div class="mr-auto p-2">
                    <div t-if="o.date_order" class="col-auto mw-100 mb-2">
                        <p> <strong style="text-decoration: underline;">Date:</strong> <span t-field="o.date_order"/></p>
                        <p  style="font-size: 12px;">REF PROJET: <span t-field="o.project_id.code"/></p>
                    </div>
                        
                    <div class="row">
                        <div class="col-6" style="font-size: 12px;">    
                            <p>
                                REF D.A: <span />
                            </p>
                        </div>
                        <div class="col-6" style="font-size: 12px;">    
                            <p>
                                N° PRO FORMA / <span />
                            </p>
                        </div>
                    </div>    
                </div>
                <div class="p-2" style="font-size: 17px;margin-left: 25%;">
                    <div class="row">
                        <div class="col-6">
                            <p style="text-decoration: underline;">FOURNISSEUR:</p>
                            <br/>
                            <p style="font-size: 15px;text-decoration: underline;">N°DEVIS:</p>
                         </div>   
                        <div class="col-6">
                            <p style="font-weight: bold; text-transform: uppercase;" t-field="o.partner_id.name"/>
                            <br/>
                            <p></p>
                        </div>
                    </div>
                    
                </div>   
            </div>
            
        </xpath>
        <xpath expr="//div[hasclass('page')]/table" position="replace">
            <table class="table table-bordered">
                <thead>
                    <tr>
                      <th scope="col">
                          ITEM
                      </th>
                      <th scope="col">
                          PROJET
                      </th>
                      <th scope="col" width="30%"> LIBELLE</th>
                      <th scope="col">UM</th>
                      <th scope="col">Qte</th>
                      <th scope="col" width="10%">PU HT</th>
                      <th scope="col">% Remise</th>
                      <th scope="col" width="15%">PU net HT</th>
                      <th scope="col" width="20%">PRIX TOTAL HT</th>  
                    </tr>
                </thead>
                <tbody>
                    <t t-set="current_subtotal" t-value="0"/>
                    <t t-foreach="o.order_line" t-as="line">
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                        <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                          <td></td>
                          <td id="project"></td>
                          <td id="product" width="30%">
                                <span t-field="line.name"/>
                            </td>
                            <td class="text-center">
                                <span t-field="line.product_uom"/>
                            </td>
                            <td class="text-center">
                                <span t-field="line.product_qty"/>
                            </td>
                            <td class="text-center" width="10%">
                                <span t-field="line.price_unit"/>
                            </td>
                            <td class="text-center">
                                
                            </td>
                            <td class="text-center" width="15%">
                                <span t-field="line.price_unit"/>
                            </td>
                            <td class="text-center" width="20%">
                                <span t-field="line.price_subtotal"/>
                            </td>
                        </tr>
                      </t>      
                </tbody>    
            </table>
        </xpath>
        <xpath expr="//div[hasclass('page')]/p[@t-field='o.notes']" position="before">
            <div class="row justify-content-center" style="font-size:16px; padding-bottom:30px;">
                <div class="col-6" style="font-weight: bold; font-size: 15px;">
                    <p> Arrêt la présente facture à la somme de:</p>
                </div>
                <div class="col-6" >
                                    <span t-field="o.amount_to_word"/> <span t-field="o.currency_id.currency_unit_label"/> <span t-field="o.currency_id.symbol"/>
                </div>
            </div>
            <table class="table table-bordered">
                <tr>
                  <th scope="col" rowspan="2" width="40%" style="font-size: 14px;">
                      <p>Adresse de livraison : <span t-field="o.dest_address_id"/></p>
                      <p>Nom et contact livraison: <span t-field="o.dest_address_id"/></p>
                      <p>Modalité de livraison: DDP</p>
                      <p>Modalité e règlement: CONDITION HAITUELLE</p>
                      <p>Date de livraison souhaité: <span t-field="o.date_order"/></p>
                  </th>
                  <th scope="col" width="15%" style="color: #b3b3b3">
                  </th>
                  <th scope="col" style="font-size: 9px;" width="20%">SIGNATURE ET CACHET DAF</th>
                  <th scope="col" style="font-size: 9px;" width="25%">SIGNANTURE ET CACHET DG</th>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
            </table>
        </xpath>
        <!-- Deleting shipping address on top-->
        <xpath expr="//t[@t-call='web.external_layout']/t[3]" position="replace">
            <t t-if="o.dest_address_id"><span/></t>
        </xpath>
    </template>
</odoo>